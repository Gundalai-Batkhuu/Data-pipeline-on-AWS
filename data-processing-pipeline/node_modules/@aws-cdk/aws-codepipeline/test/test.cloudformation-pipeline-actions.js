"use strict";
const assert_1 = require("@aws-cdk/assert");
const aws_cloudformation_1 = require("@aws-cdk/aws-cloudformation");
const aws_codebuild_1 = require("@aws-cdk/aws-codebuild");
const aws_codecommit_1 = require("@aws-cdk/aws-codecommit");
const aws_codepipeline_api_1 = require("@aws-cdk/aws-codepipeline-api");
const aws_iam_1 = require("@aws-cdk/aws-iam");
const aws_iam_2 = require("@aws-cdk/aws-iam");
const cdk = require("@aws-cdk/cdk");
const lib_1 = require("../lib");
/**
 * A test stack with a half-prepared pipeline ready to add CloudFormation actions to
 */
class TestFixture extends cdk.Stack {
    constructor() {
        super();
        this.pipeline = new lib_1.Pipeline(this, 'Pipeline');
        this.sourceStage = new lib_1.Stage(this.pipeline, 'Source', { pipeline: this.pipeline });
        this.deployStage = new lib_1.Stage(this.pipeline, 'Deploy', { pipeline: this.pipeline });
        this.repo = new aws_codecommit_1.Repository(this, 'MyVeryImportantRepo', { repositoryName: 'my-very-important-repo' });
        this.source = new aws_codecommit_1.PipelineSourceAction(this, 'Source', {
            stage: this.sourceStage,
            outputArtifactName: 'SourceArtifact',
            repository: this.repo,
        });
    }
}
module.exports = {
    'CreateChangeSetAction can be used to make a change set from a CodePipeline'(test) {
        const stack = new cdk.Stack();
        const pipeline = new lib_1.Pipeline(stack, 'MagicPipeline');
        const changeSetExecRole = new aws_iam_1.Role(stack, 'ChangeSetRole', {
            assumedBy: new aws_iam_2.ServicePrincipal('cloudformation.amazonaws.com'),
        });
        /** Source! */
        const repo = new aws_codecommit_1.Repository(stack, 'MyVeryImportantRepo', { repositoryName: 'my-very-important-repo' });
        const sourceStage = new lib_1.Stage(pipeline, 'source', { pipeline });
        const source = new aws_codecommit_1.PipelineSourceAction(stack, 'source', {
            stage: sourceStage,
            outputArtifactName: 'SourceArtifact',
            repository: repo,
            pollForSourceChanges: true,
        });
        /** Build! */
        const buildStage = new lib_1.Stage(pipeline, 'build', { pipeline });
        const buildArtifacts = new aws_codebuild_1.CodePipelineBuildArtifacts();
        const project = new aws_codebuild_1.Project(stack, 'MyBuildProject', {
            source: new aws_codebuild_1.CodePipelineSource(),
            artifacts: buildArtifacts,
        });
        const buildAction = new aws_codebuild_1.PipelineBuildAction(stack, 'build', {
            stage: buildStage,
            project,
            inputArtifact: source.outputArtifact,
            outputArtifactName: "OutputYo"
        });
        /** Deploy! */
        // To execute a change set - yes, you probably do need *:* ü§∑‚Äç‚ôÄÔ∏è
        changeSetExecRole.addToPolicy(new aws_iam_2.PolicyStatement().addAllResources().addAction("*"));
        const prodStage = new lib_1.Stage(stack, 'prod', { pipeline });
        const stackName = 'BrelandsStack';
        const changeSetName = 'MyMagicalChangeSet';
        new aws_cloudformation_1.PipelineCreateReplaceChangeSetAction(stack, 'BuildChangeSetProd', {
            stage: prodStage,
            stackName,
            changeSetName,
            deploymentRole: changeSetExecRole,
            templatePath: new aws_codepipeline_api_1.ArtifactPath(buildAction.outputArtifact, 'template.yaml'),
            templateConfiguration: new aws_codepipeline_api_1.ArtifactPath(buildAction.outputArtifact, 'templateConfig.json'),
            adminPermissions: false,
        });
        new aws_cloudformation_1.PipelineExecuteChangeSetAction(stack, 'ExecuteChangeSetProd', {
            stage: prodStage,
            stackName,
            changeSetName,
        });
        assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodePipeline::Pipeline', {
            "ArtifactStore": {
                "Location": {
                    "Ref": "MagicPipelineArtifactsBucket212FE7BF"
                },
                "Type": "S3"
            }, "RoleArn": {
                "Fn::GetAtt": ["MagicPipelineRoleFB2BD6DE",
                    "Arn"
                ]
            },
            "Stages": [{
                    "Actions": [
                        {
                            "ActionTypeId": {
                                "Category": "Source",
                                "Owner": "AWS", "Provider": "CodeCommit", "Version": "1"
                            },
                            "Configuration": {
                                "RepositoryName": {
                                    "Fn::GetAtt": [
                                        "MyVeryImportantRepo11BC3EBD",
                                        "Name"
                                    ]
                                },
                                "BranchName": "master",
                                "PollForSourceChanges": true
                            },
                            "InputArtifacts": [],
                            "Name": "source",
                            "OutputArtifacts": [
                                {
                                    "Name": "SourceArtifact"
                                }
                            ],
                            "RunOrder": 1
                        }
                    ],
                    "Name": "source"
                },
                {
                    "Actions": [
                        {
                            "ActionTypeId": {
                                "Category": "Build",
                                "Owner": "AWS",
                                "Provider": "CodeBuild",
                                "Version": "1"
                            },
                            "Configuration": {
                                "ProjectName": {
                                    "Ref": "MyBuildProject30DB9D6E"
                                }
                            },
                            "InputArtifacts": [
                                {
                                    "Name": "SourceArtifact"
                                }
                            ],
                            "Name": "build",
                            "OutputArtifacts": [
                                {
                                    "Name": "OutputYo"
                                }
                            ],
                            "RunOrder": 1
                        }
                    ],
                    "Name": "build"
                },
                {
                    "Actions": [
                        {
                            "ActionTypeId": {
                                "Category": "Deploy",
                                "Owner": "AWS",
                                "Provider": "CloudFormation",
                                "Version": "1"
                            },
                            "Configuration": {
                                "ActionMode": "CHANGE_SET_REPLACE",
                                "ChangeSetName": "MyMagicalChangeSet",
                                "RoleArn": {
                                    "Fn::GetAtt": [
                                        "ChangeSetRole0BCF99E6",
                                        "Arn"
                                    ]
                                },
                                "StackName": "BrelandsStack",
                                "TemplatePath": "OutputYo::template.yaml",
                                "TemplateConfiguration": "OutputYo::templateConfig.json"
                            },
                            "InputArtifacts": [{ "Name": "OutputYo" }],
                            "Name": "BuildChangeSetProd",
                            "OutputArtifacts": [],
                            "RunOrder": 1
                        },
                        {
                            "ActionTypeId": {
                                "Category": "Deploy",
                                "Owner": "AWS",
                                "Provider": "CloudFormation",
                                "Version": "1"
                            },
                            "Configuration": {
                                "ActionMode": "CHANGE_SET_EXECUTE",
                                "ChangeSetName": "MyMagicalChangeSet"
                            },
                            "InputArtifacts": [],
                            "Name": "ExecuteChangeSetProd",
                            "OutputArtifacts": [],
                            "RunOrder": 1
                        }
                    ],
                    "Name": "prod"
                }
            ]
        }));
        test.done();
    },
    'fullPermissions leads to admin role and full IAM capabilities'(test) {
        // GIVEN
        const stack = new TestFixture();
        // WHEN
        new aws_cloudformation_1.PipelineCreateUpdateStackAction(stack.deployStage, 'CreateUpdate', {
            stage: stack.deployStage,
            stackName: 'MyStack',
            templatePath: stack.source.outputArtifact.atPath('template.yaml'),
            adminPermissions: true,
        });
        const roleId = "PipelineDeployCreateUpdateRole515CB7D4";
        // THEN: Action in Pipeline has named IAM capabilities
        assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodePipeline::Pipeline', {
            "Stages": [
                { "Name": "Source" /* don't care about the rest */ },
                {
                    "Name": "Deploy",
                    "Actions": [
                        {
                            "Configuration": {
                                "Capabilities": "CAPABILITY_NAMED_IAM",
                                "RoleArn": { "Fn::GetAtt": [roleId, "Arn"] },
                                "ActionMode": "CREATE_UPDATE",
                                "StackName": "MyStack",
                                "TemplatePath": "SourceArtifact::template.yaml"
                            },
                            "InputArtifacts": [{ "Name": "SourceArtifact" }],
                            "Name": "CreateUpdate",
                        },
                    ],
                }
            ]
        }));
        // THEN: Role is created with full permissions
        assert_1.expect(stack).to(assert_1.haveResource('AWS::IAM::Policy', {
            PolicyDocument: {
                Version: '2012-10-17',
                Statement: [
                    {
                        Action: "*",
                        Effect: 'Allow',
                        Resource: "*"
                    }
                ],
            },
            Roles: [{ Ref: roleId }]
        }));
        test.done();
    },
    'outputFileName leads to creation of output artifact'(test) {
        // GIVEN
        const stack = new TestFixture();
        // WHEN
        new aws_cloudformation_1.PipelineCreateUpdateStackAction(stack, 'CreateUpdate', {
            stage: stack.deployStage,
            stackName: 'MyStack',
            templatePath: stack.source.outputArtifact.atPath('template.yaml'),
            outputFileName: 'CreateResponse.json',
            adminPermissions: false,
        });
        // THEN: Action has output artifacts
        assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodePipeline::Pipeline', {
            "Stages": [
                { "Name": "Source" /* don't care about the rest */ },
                {
                    "Name": "Deploy",
                    "Actions": [
                        {
                            "OutputArtifacts": [{ "Name": "DeployCreateUpdateArtifact" }],
                            "Name": "CreateUpdate",
                        },
                    ],
                }
            ]
        }));
        test.done();
    },
    'replaceOnFailure switches action type'(test) {
        // GIVEN
        const stack = new TestFixture();
        // WHEN
        new aws_cloudformation_1.PipelineCreateUpdateStackAction(stack, 'CreateUpdate', {
            stage: stack.deployStage,
            stackName: 'MyStack',
            templatePath: stack.source.outputArtifact.atPath('template.yaml'),
            replaceOnFailure: true,
            adminPermissions: false,
        });
        // THEN: Action has output artifacts
        assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodePipeline::Pipeline', {
            "Stages": [
                { "Name": "Source" /* don't care about the rest */ },
                {
                    "Name": "Deploy",
                    "Actions": [
                        {
                            "Configuration": {
                                "ActionMode": "REPLACE_ON_FAILURE",
                            },
                            "Name": "CreateUpdate",
                        },
                    ],
                }
            ]
        }));
        test.done();
    },
    'parameterOverrides are serialized as a string'(test) {
        // GIVEN
        const stack = new TestFixture();
        // WHEN
        new aws_cloudformation_1.PipelineCreateUpdateStackAction(stack, 'CreateUpdate', {
            stage: stack.deployStage,
            stackName: 'MyStack',
            templatePath: stack.source.outputArtifact.atPath('template.yaml'),
            adminPermissions: false,
            parameterOverrides: {
                RepoName: stack.repo.repositoryName
            }
        });
        // THEN
        assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodePipeline::Pipeline', {
            "Stages": [
                { "Name": "Source" /* don't care about the rest */ },
                {
                    "Name": "Deploy",
                    "Actions": [
                        {
                            "Configuration": {
                                "ParameterOverrides": { "Fn::Join": ["", [
                                            "{\"RepoName\":\"",
                                            { "Fn::GetAtt": ["MyVeryImportantRepo11BC3EBD", "Name"] },
                                            "\"}"
                                        ]] }
                            },
                            "Name": "CreateUpdate",
                        },
                    ],
                }
            ]
        }));
        test.done();
    },
    'Action service role is passed to template'(test) {
        const stack = new TestFixture();
        const importedRole = aws_iam_1.Role.import(stack, 'ImportedRole', {
            roleArn: 'arn:aws:iam::000000000000:role/action-role'
        });
        const freshRole = new aws_iam_1.Role(stack, 'FreshRole', {
            assumedBy: new aws_iam_2.ServicePrincipal('magicservice')
        });
        new aws_cloudformation_1.PipelineExecuteChangeSetAction(stack.pipeline, 'ImportedRoleAction', {
            role: importedRole,
            changeSetName: 'magicSet',
            stackName: 'magicStack',
            stage: stack.deployStage
        });
        new aws_cloudformation_1.PipelineExecuteChangeSetAction(stack.pipeline, 'FreshRoleAction', {
            role: freshRole,
            changeSetName: 'magicSet',
            stackName: 'magicStack',
            stage: stack.deployStage
        });
        assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodePipeline::Pipeline', {
            "Stages": [
                {
                    "Name": "Source" /* don't care about the rest */
                },
                {
                    "Name": "Deploy",
                    "Actions": [
                        {
                            "Name": "ImportedRoleAction",
                            "RoleArn": "arn:aws:iam::000000000000:role/action-role"
                        },
                        {
                            "Name": "FreshRoleAction",
                            "RoleArn": {
                                "Fn::GetAtt": [
                                    "FreshRole472F6E18",
                                    "Arn"
                                ]
                            }
                        }
                    ]
                }
            ]
        }));
        test.done();
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5jbG91ZGZvcm1hdGlvbi1waXBlbGluZS1hY3Rpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGVzdC5jbG91ZGZvcm1hdGlvbi1waXBlbGluZS1hY3Rpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw0Q0FBeUU7QUFDekUsb0VBQW9KO0FBQ3BKLDBEQUFzSDtBQUN0SCw0REFBMkU7QUFDM0Usd0VBQTZEO0FBQzdELDhDQUF3QztBQUN4Qyw4Q0FBcUU7QUFDckUsb0NBQXFDO0FBRXJDLGdDQUF5QztBQXFaekM7O0dBRUc7QUFDSCxNQUFNLFdBQVksU0FBUSxHQUFHLENBQUMsS0FBSztJQU9qQztRQUNBLEtBQUssRUFBRSxDQUFDO1FBRVIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLGNBQVEsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLFdBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUNuRixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksV0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQ25GLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSwyQkFBVSxDQUFDLElBQUksRUFBRSxxQkFBcUIsRUFBRSxFQUFFLGNBQWMsRUFBRSx3QkFBd0IsRUFBRSxDQUFDLENBQUM7UUFDdEcsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLHFDQUFvQixDQUFDLElBQUksRUFBRSxRQUFRLEVBQUU7WUFDckQsS0FBSyxFQUFFLElBQUksQ0FBQyxXQUFXO1lBQ3ZCLGtCQUFrQixFQUFFLGdCQUFnQjtZQUNwQyxVQUFVLEVBQUUsSUFBSSxDQUFDLElBQUk7U0FDdEIs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QUFvQixFQUFFO1lBQ3ZFLElBQUksRUFBRSxZQUFZO1lBQ2xCLGFBQWEsRUFBRSxVQUFVO1lBQ3pCLFNBQVMsRUFBRSxZQUFZO1lBQ3ZCLEtBQUssRUFBRSxLQUFLLENBQUMsV0FBVztTQUN6QixDQUFDLENBQUM7UUFFSCxJQUFJLG1EQUE4QixDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsaUJBQWlCLEVBQUU7WUFDcEUsSUFBSSxFQUFFLFNBQVM7WUFDZixhQUFhLEVBQUUsVUFBVTtZQUN6QixTQUFTLEVBQUUsWUFBWTtZQUN2QixLQUFLLEVBQUUsS0FBSyxDQUFDLFdBQVc7U0FDekIsQ0FBQyxDQUFDO1FBRUgsZUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyx5QkFBZ0IsQ0FBQyw2QkFBNkIsRUFBRTtZQUMvRCxRQUFRLEVBQUU7Z0JBQ1I7b0JBQ0UsTUFBTSxFQUFFLFFBQVEsQ0FBQywrQkFBK0I7aUJBQ2pEO2dCQUNEO29CQUNFLE1BQU0sRUFBRSxRQUFRO29CQUNoQixTQUFTLEVBQUU7d0JBQ1Q7NEJBQ0UsTUFBTSxFQUFFLG9CQUFvQjs0QkFDNUIsU0FBUyxFQUFFLDRDQUE0Qzt5QkFDeEQ7d0JBQ0Q7NEJBQ0UsTUFBTSxFQUFFLGlCQUFpQjs0QkFDekIsU0FBUyxFQUFFO2dDQUNULFlBQVksRUFBRTtvQ0FDWixtQkFBbUI7b0NBQ25CLEtBQUs7aUNBQ047NkJBQ0Y7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGLENBQUMsQ0FBQyxDQUFDO1FBRUosSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2QsQ0FBQztDQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleHBlY3QsIGhhdmVSZXNvdXJjZSwgaGF2ZVJlc291cmNlTGlrZSB9IGZyb20gJ0Bhd3MtY2RrL2Fzc2VydCc7XG5pbXBvcnQgeyBQaXBlbGluZUNyZWF0ZVJlcGxhY2VDaGFuZ2VTZXRBY3Rpb24sIFBpcGVsaW5lQ3JlYXRlVXBkYXRlU3RhY2tBY3Rpb24sIFBpcGVsaW5lRXhlY3V0ZUNoYW5nZVNldEFjdGlvbiB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1jbG91ZGZvcm1hdGlvbic7XG5pbXBvcnQgeyBDb2RlUGlwZWxpbmVCdWlsZEFydGlmYWN0cywgQ29kZVBpcGVsaW5lU291cmNlLCBQaXBlbGluZUJ1aWxkQWN0aW9uLCBQcm9qZWN0IH0gZnJvbSAnQGF3cy1jZGsvYXdzLWNvZGVidWlsZCc7XG5pbXBvcnQgeyBQaXBlbGluZVNvdXJjZUFjdGlvbiwgUmVwb3NpdG9yeSB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1jb2RlY29tbWl0JztcbmltcG9ydCB7IEFydGlmYWN0UGF0aCB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1jb2RlcGlwZWxpbmUtYXBpJztcbmltcG9ydCB7IFJvbGUgfSBmcm9tICdAYXdzLWNkay9hd3MtaWFtJztcbmltcG9ydCB7IFBvbGljeVN0YXRlbWVudCwgU2VydmljZVByaW5jaXBhbCB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1pYW0nO1xuaW1wb3J0IGNkayA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2NkaycpO1xuaW1wb3J0IHsgVGVzdCB9IGZyb20gJ25vZGV1bml0JztcbmltcG9ydCB7IFBpcGVsaW5lLCBTdGFnZSB9IGZyb20gJy4uL2xpYic7XG5cbi8vIHRzbGludDpkaXNhYmxlOm9iamVjdC1saXRlcmFsLWtleS1xdW90ZXNcblxuZXhwb3J0ID0ge1xuICAnQ3JlYXRlQ2hhbmdlU2V0QWN0aW9uIGNhbiBiZSB1c2VkIHRvIG1ha2UgYSBjaGFuZ2Ugc2V0IGZyb20gYSBDb2RlUGlwZWxpbmUnKHRlc3Q6IFRlc3QpIHtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgY29uc3QgcGlwZWxpbmUgPSBuZXcgUGlwZWxpbmUoc3RhY2ssICdNYWdpY1BpcGVsaW5lJyk7XG5cbiAgY29uc3QgY2hhbmdlU2V0RXhlY1JvbGUgPSBuZXcgUm9sZShzdGFjaywgJ0NoYW5nZVNldFJvbGUnLCB7XG4gICAgYXNzdW1lZEJ5OiBuZXcgU2VydmljZVByaW5jaXBhbCgnY2xvdWRmb3JtYXRpb24uYW1hem9uYXdzLmNvbScpLFxuICB9KTtcblxuICAvKiogU291cmNlISAqL1xuICBjb25zdCByZXBvID0gbmV3IFJlcG9zaXRvcnkoc3RhY2ssICdNeVZlcnlJbXBvcnRhbnRSZXBvJywgeyByZXBvc2l0b3J5TmFtZTogJ215LXZlcnktaW1wb3J0YW50LXJlcG8nIH0pO1xuXG4gIGNvbnN0IHNvdXJjZVN0YWdlID0gbmV3IFN0YWdlKHBpcGVsaW5lLCAnc291cmNlJywgeyBwaXBlbGluZSB9KTtcblxuICBjb25zdCBzb3VyY2UgPSBuZXcgUGlwZWxpbmVTb3VyY2VBY3Rpb24oc3RhY2ssICdzb3VyY2UnLCB7XG4gICAgc3RhZ2U6IHNvdXJjZVN0YWdlLFxuICAgIG91dHB1dEFydGlmYWN0TmFtZTogJ1NvdXJjZUFydGlmYWN0JyxcbiAgICByZXBvc2l0b3J5OiByZXBvLFxuICAgIHBvbGxGb3JTb3VyY2VDaGFuZ2VzOiB0cnVlLFxuICB9KTtcblxuICAvKiogQnVpbGQhICovXG5cbiAgY29uc3QgYnVpbGRTdGFnZSA9IG5ldyBTdGFnZShwaXBlbGluZSwgJ2J1aWxkJywgeyBwaXBlbGluZSB9KTtcbiAgY29uc3QgYnVpbGRBcnRpZmFjdHMgPSBuZXcgQ29kZVBpcGVsaW5lQnVpbGRBcnRpZmFjdHMoKTtcbiAgY29uc3QgcHJvamVjdCA9IG5ldyBQcm9qZWN0KHN0YWNrLCAnTXlCdWlsZFByb2plY3QnLCB7XG4gICAgc291cmNlOiBuZXcgQ29kZVBpcGVsaW5lU291cmNlKCksXG4gICAgYXJ0aWZhY3RzOiBidWlsZEFydGlmYWN0cyxcbiAgfSk7XG5cbiAgY29uc3QgYnVpbGRBY3Rpb24gPSBuZXcgUGlwZWxpbmVCdWlsZEFjdGlvbihzdGFjaywgJ2J1aWxkJywge1xuICAgIHN0YWdlOiBidWlsZFN0YWdlLFxuICAgIHByb2plY3QsXG4gICAgaW5wdXRBcnRpZmFjdDogc291cmNlLm91dHB1dEFydGlmYWN0LFxuICAgIG91dHB1dEFydGlmYWN0TmFtZTogXCJPdXRwdXRZb1wiXG4gIH0pO1xuXG4gIC8qKiBEZXBsb3khICovXG5cbiAgLy8gVG8gZXhlY3V0ZSBhIGNoYW5nZSBzZXQgLSB5ZXMsIHlvdSBwcm9iYWJseSBkbyBuZWVkICo6KiDwn6S34oCN4pmA77iPXG4gIGNoYW5nZVNldEV4ZWNSb2xlLmFkZFRvUG9saWN5KG5ldyBQb2xpY3lTdGF0ZW1lbnQoKS5hZGRBbGxSZXNvdXJjZXMoKS5hZGRBY3Rpb24oXCIqXCIpKTtcblxuICBjb25zdCBwcm9kU3RhZ2UgPSBuZXcgU3RhZ2Uoc3RhY2ssICdwcm9kJywgeyBwaXBlbGluZSB9KTtcbiAgY29uc3Qgc3RhY2tOYW1lID0gJ0JyZWxhbmRzU3RhY2snO1xuICBjb25zdCBjaGFuZ2VTZXROYW1lID0gJ015TWFnaWNhbENoYW5nZVNldCc7XG5cbiAgbmV3IFBpcGVsaW5lQ3JlYXRlUmVwbGFjZUNoYW5nZVNldEFjdGlvbihzdGFjaywgJ0J1aWxkQ2hhbmdlU2V0UHJvZCcsIHtcbiAgICBzdGFnZTogcHJvZFN0YWdlLFxuICAgIHN0YWNrTmFtZSxcbiAgICBjaGFuZ2VTZXROYW1lLFxuICAgIGRlcGxveW1lbnRSb2xlOiBjaGFuZ2VTZXRFeGVjUm9sZSxcbiAgICB0ZW1wbGF0ZVBhdGg6IG5ldyBBcnRpZmFjdFBhdGgoYnVpbGRBY3Rpb24ub3V0cHV0QXJ0aWZhY3QsICd0ZW1wbGF0ZS55YW1sJyksXG4gICAgdGVtcGxhdGVDb25maWd1cmF0aW9uOiBuZXcgQXJ0aWZhY3RQYXRoKGJ1aWxkQWN0aW9uLm91dHB1dEFydGlmYWN0LCAndGVtcGxhdGVDb25maWcuanNvbicpLFxuICAgIGFkbWluUGVybWlzc2lvbnM6IGZhbHNlLFxuICB9KTtcblxuICBuZXcgUGlwZWxpbmVFeGVjdXRlQ2hhbmdlU2V0QWN0aW9uKHN0YWNrLCAnRXhlY3V0ZUNoYW5nZVNldFByb2QnLCB7XG4gICAgc3RhZ2U6IHByb2RTdGFnZSxcbiAgICBzdGFja05hbWUsXG4gICAgY2hhbmdlU2V0TmFtZSxcbiAgfSk7XG5cbiAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2VMaWtlKCdBV1M6OkNvZGVQaXBlbGluZTo6UGlwZWxpbmUnLCB7XG4gICAgXCJBcnRpZmFjdFN0b3JlXCI6IHtcbiAgICBcIkxvY2F0aW9uXCI6IHtcbiAgICAgIFwiUmVmXCI6IFwiTWFnaWNQaXBlbGluZUFydGlmYWN0c0J1Y2tldDIxMkZFN0JGXCJcbiAgICB9LFxuICAgIFwiVHlwZVwiOiBcIlMzXCJcbiAgICB9LCBcIlJvbGVBcm5cIjoge1xuICAgIFwiRm46OkdldEF0dFwiOiBbXCJNYWdpY1BpcGVsaW5lUm9sZUZCMkJENkRFXCIsXG4gICAgICBcIkFyblwiXG4gICAgXVxuICAgIH0sXG4gICAgXCJTdGFnZXNcIjogW3tcbiAgICBcIkFjdGlvbnNcIjogW1xuICAgICAge1xuICAgICAgXCJBY3Rpb25UeXBlSWRcIjoge1xuICAgICAgICBcIkNhdGVnb3J5XCI6IFwiU291cmNlXCIsXG4gICAgICAgIFwiT3duZXJcIjogXCJBV1NcIiwgXCJQcm92aWRlclwiOiBcIkNvZGVDb21taXRcIiwgXCJWZXJzaW9uXCI6IFwiMVwiXG4gICAgICB9LFxuICAgICAgXCJDb25maWd1cmF0aW9uXCI6IHtcbiAgICAgICAgXCJSZXBvc2l0b3J5TmFtZVwiOiB7XG4gICAgICAgIFwiRm46OkdldEF0dFwiOiBbXG4gICAgICAgICAgXCJNeVZlcnlJbXBvcnRhbnRSZXBvMTFCQzNFQkRcIixcbiAgICAgICAgICBcIk5hbWVcIlxuICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIFwiQnJhbmNoTmFtZVwiOiBcIm1hc3RlclwiLFxuICAgICAgICBcIlBvbGxGb3JTb3VyY2VDaGFuZ2VzXCI6IHRydWVcbiAgICAgIH0sXG4gICAgICBcIklucHV0QXJ0aWZhY3RzXCI6IFtdLFxuICAgICAgXCJOYW1lXCI6IFwic291cmNlXCIsXG4gICAgICBcIk91dHB1dEFydGlmYWN0c1wiOiBbXG4gICAgICAgIHtcbiAgICAgICAgXCJOYW1lXCI6IFwiU291cmNlQXJ0aWZhY3RcIlxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgXCJSdW5PcmRlclwiOiAxXG4gICAgICB9XG4gICAgXSxcbiAgICBcIk5hbWVcIjogXCJzb3VyY2VcIlxuICAgIH0sXG4gICAge1xuICAgIFwiQWN0aW9uc1wiOiBbXG4gICAgICB7XG4gICAgICBcIkFjdGlvblR5cGVJZFwiOiB7XG4gICAgICAgIFwiQ2F0ZWdvcnlcIjogXCJCdWlsZFwiLFxuICAgICAgICBcIk93bmVyXCI6IFwiQVdTXCIsXG4gICAgICAgIFwiUHJvdmlkZXJcIjogXCJDb2RlQnVpbGRcIixcbiAgICAgICAgXCJWZXJzaW9uXCI6IFwiMVwiXG4gICAgICB9LFxuICAgICAgXCJDb25maWd1cmF0aW9uXCI6IHtcbiAgICAgICAgXCJQcm9qZWN0TmFtZVwiOiB7XG4gICAgICAgIFwiUmVmXCI6IFwiTXlCdWlsZFByb2plY3QzMERCOUQ2RVwiXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBcIklucHV0QXJ0aWZhY3RzXCI6IFtcbiAgICAgICAge1xuICAgICAgICBcIk5hbWVcIjogXCJTb3VyY2VBcnRpZmFjdFwiXG4gICAgICAgIH1cbiAgICAgIF0sXG4gICAgICBcIk5hbWVcIjogXCJidWlsZFwiLFxuICAgICAgXCJPdXRwdXRBcnRpZmFjdHNcIjogW1xuICAgICAgICB7XG4gICAgICAgIFwiTmFtZVwiOiBcIk91dHB1dFlvXCJcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIFwiUnVuT3JkZXJcIjogMVxuICAgICAgfVxuICAgIF0sXG4gICAgXCJOYW1lXCI6IFwiYnVpbGRcIlxuICAgIH0sXG4gICAge1xuICAgIFwiQWN0aW9uc1wiOiBbXG4gICAgICB7XG4gICAgICBcIkFjdGlvblR5cGVJZFwiOiB7XG4gICAgICAgIFwiQ2F0ZWdvcnlcIjogXCJEZXBsb3lcIixcbiAgICAgICAgXCJPd25lclwiOiBcIkFXU1wiLFxuICAgICAgICBcIlByb3ZpZGVyXCI6IFwiQ2xvdWRGb3JtYXRpb25cIixcbiAgICAgICAgXCJWZXJzaW9uXCI6IFwiMVwiXG4gICAgICB9LFxuICAgICAgXCJDb25maWd1cmF0aW9uXCI6IHtcbiAgICAgICAgXCJBY3Rpb25Nb2RlXCI6IFwiQ0hBTkdFX1NFVF9SRVBMQUNFXCIsXG4gICAgICAgIFwiQ2hhbmdlU2V0TmFtZVwiOiBcIk15TWFnaWNhbENoYW5nZVNldFwiLFxuICAgICAgICBcIlJvbGVBcm5cIjoge1xuICAgICAgICBcIkZuOjpHZXRBdHRcIjogW1xuICAgICAgICAgIFwiQ2hhbmdlU2V0Um9sZTBCQ0Y5OUU2XCIsXG4gICAgICAgICAgXCJBcm5cIlxuICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIFwiU3RhY2tOYW1lXCI6IFwiQnJlbGFuZHNTdGFja1wiLFxuICAgICAgICBcIlRlbXBsYXRlUGF0aFwiOiBcIk91dHB1dFlvOjp0ZW1wbGF0ZS55YW1sXCIsXG4gICAgICAgIFwiVGVtcGxhdGVDb25maWd1cmF0aW9uXCI6IFwiT3V0cHV0WW86OnRlbXBsYXRlQ29uZmlnLmpzb25cIlxuICAgICAgfSxcbiAgICAgIFwiSW5wdXRBcnRpZmFjdHNcIjogW3tcIk5hbWVcIjogXCJPdXRwdXRZb1wifV0sXG4gICAgICBcIk5hbWVcIjogXCJCdWlsZENoYW5nZVNldFByb2RcIixcbiAgICAgIFwiT3V0cHV0QXJ0aWZhY3RzXCI6IFtdLFxuICAgICAgXCJSdW5PcmRlclwiOiAxXG4gICAgICB9LFxuICAgICAge1xuICAgICAgXCJBY3Rpb25UeXBlSWRcIjoge1xuICAgICAgICBcIkNhdGVnb3J5XCI6IFwiRGVwbG95XCIsXG4gICAgICAgIFwiT3duZXJcIjogXCJBV1NcIixcbiAgICAgICAgXCJQcm92aWRlclwiOiBcIkNsb3VkRm9ybWF0aW9uXCIsXG4gICAgICAgIFwiVmVyc2lvblwiOiBcIjFcIlxuICAgICAgfSxcbiAgICAgIFwiQ29uZmlndXJhdGlvblwiOiB7XG4gICAgICAgIFwiQWN0aW9uTW9kZVwiOiBcIkNIQU5HRV9TRVRfRVhFQ1VURVwiLFxuICAgICAgICBcIkNoYW5nZVNldE5hbWVcIjogXCJNeU1hZ2ljYWxDaGFuZ2VTZXRcIlxuICAgICAgfSxcbiAgICAgIFwiSW5wdXRBcnRpZmFjdHNcIjogW10sXG4gICAgICBcIk5hbWVcIjogXCJFeGVjdXRlQ2hhbmdlU2V0UHJvZFwiLFxuICAgICAgXCJPdXRwdXRBcnRpZmFjdHNcIjogW10sXG4gICAgICBcIlJ1bk9yZGVyXCI6IDFcbiAgICAgIH1cbiAgICBdLFxuICAgIFwiTmFtZVwiOiBcInByb2RcIlxuICAgIH1cbiAgICBdXG4gIH0pKTtcblxuICB0ZXN0LmRvbmUoKTtcblxuICB9LFxuXG4gICdmdWxsUGVybWlzc2lvbnMgbGVhZHMgdG8gYWRtaW4gcm9sZSBhbmQgZnVsbCBJQU0gY2FwYWJpbGl0aWVzJyh0ZXN0OiBUZXN0KSB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHN0YWNrID0gbmV3IFRlc3RGaXh0dXJlKCk7XG5cbiAgLy8gV0hFTlxuICBuZXcgUGlwZWxpbmVDcmVhdGVVcGRhdGVTdGFja0FjdGlvbihzdGFjay5kZXBsb3lTdGFnZSwgJ0NyZWF0ZVVwZGF0ZScsIHtcbiAgICBzdGFnZTogc3RhY2suZGVwbG95U3RhZ2UsXG4gICAgc3RhY2tOYW1lOiAnTXlTdGFjaycsXG4gICAgdGVtcGxhdGVQYXRoOiBzdGFjay5zb3VyY2Uub3V0cHV0QXJ0aWZhY3QuYXRQYXRoKCd0ZW1wbGF0ZS55YW1sJyksXG4gICAgYWRtaW5QZXJtaXNzaW9uczogdHJ1ZSxcbiAgfSk7XG5cbiAgY29uc3Qgcm9sZUlkID0gXCJQaXBlbGluZURlcGxveUNyZWF0ZVVwZGF0ZVJvbGU1MTVDQjdENFwiO1xuXG4gIC8vIFRIRU46IEFjdGlvbiBpbiBQaXBlbGluZSBoYXMgbmFtZWQgSUFNIGNhcGFiaWxpdGllc1xuICBleHBlY3Qoc3RhY2spLnRvKGhhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICBcIlN0YWdlc1wiOiBbXG4gICAgeyBcIk5hbWVcIjogXCJTb3VyY2VcIiAvKiBkb24ndCBjYXJlIGFib3V0IHRoZSByZXN0ICovIH0sXG4gICAge1xuICAgICAgXCJOYW1lXCI6IFwiRGVwbG95XCIsXG4gICAgICBcIkFjdGlvbnNcIjogW1xuICAgICAge1xuICAgICAgICBcIkNvbmZpZ3VyYXRpb25cIjoge1xuICAgICAgICBcIkNhcGFiaWxpdGllc1wiOiBcIkNBUEFCSUxJVFlfTkFNRURfSUFNXCIsXG4gICAgICAgIFwiUm9sZUFyblwiOiB7IFwiRm46OkdldEF0dFwiOiBbIHJvbGVJZCwgXCJBcm5cIiBdIH0sXG4gICAgICAgIFwiQWN0aW9uTW9kZVwiOiBcIkNSRUFURV9VUERBVEVcIixcbiAgICAgICAgXCJTdGFja05hbWVcIjogXCJNeVN0YWNrXCIsXG4gICAgICAgIFwiVGVtcGxhdGVQYXRoXCI6IFwiU291cmNlQXJ0aWZhY3Q6OnRlbXBsYXRlLnlhbWxcIlxuICAgICAgICB9LFxuICAgICAgICBcIklucHV0QXJ0aWZhY3RzXCI6IFt7XCJOYW1lXCI6IFwiU291cmNlQXJ0aWZhY3RcIn1dLFxuICAgICAgICBcIk5hbWVcIjogXCJDcmVhdGVVcGRhdGVcIixcbiAgICAgIH0sXG4gICAgICBdLFxuICAgIH1cbiAgICBdXG4gIH0pKTtcblxuICAvLyBUSEVOOiBSb2xlIGlzIGNyZWF0ZWQgd2l0aCBmdWxsIHBlcm1pc3Npb25zXG4gIGV4cGVjdChzdGFjaykudG8oaGF2ZVJlc291cmNlKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgIFBvbGljeURvY3VtZW50OiB7XG4gICAgICBWZXJzaW9uOiAnMjAxMi0xMC0xNycsXG4gICAgICBTdGF0ZW1lbnQ6IFtcbiAgICAgICAge1xuICAgICAgICAgIEFjdGlvbjogXCIqXCIsXG4gICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgIFJlc291cmNlOiBcIipcIlxuICAgICAgICB9XG4gICAgICBdLFxuICAgIH0sXG4gICAgUm9sZXM6IFt7IFJlZjogcm9sZUlkIH1dXG4gIH0pKTtcblxuICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnb3V0cHV0RmlsZU5hbWUgbGVhZHMgdG8gY3JlYXRpb24gb2Ygb3V0cHV0IGFydGlmYWN0Jyh0ZXN0OiBUZXN0KSB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHN0YWNrID0gbmV3IFRlc3RGaXh0dXJlKCk7XG5cbiAgLy8gV0hFTlxuICBuZXcgUGlwZWxpbmVDcmVhdGVVcGRhdGVTdGFja0FjdGlvbihzdGFjaywgJ0NyZWF0ZVVwZGF0ZScsIHtcbiAgICBzdGFnZTogc3RhY2suZGVwbG95U3RhZ2UsXG4gICAgc3RhY2tOYW1lOiAnTXlTdGFjaycsXG4gICAgdGVtcGxhdGVQYXRoOiBzdGFjay5zb3VyY2Uub3V0cHV0QXJ0aWZhY3QuYXRQYXRoKCd0ZW1wbGF0ZS55YW1sJyksXG4gICAgb3V0cHV0RmlsZU5hbWU6ICdDcmVhdGVSZXNwb25zZS5qc29uJyxcbiAgICBhZG1pblBlcm1pc3Npb25zOiBmYWxzZSxcbiAgfSk7XG5cbiAgLy8gVEhFTjogQWN0aW9uIGhhcyBvdXRwdXQgYXJ0aWZhY3RzXG4gIGV4cGVjdChzdGFjaykudG8oaGF2ZVJlc291cmNlTGlrZSgnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgIFwiU3RhZ2VzXCI6IFtcbiAgICB7IFwiTmFtZVwiOiBcIlNvdXJjZVwiIC8qIGRvbid0IGNhcmUgYWJvdXQgdGhlIHJlc3QgKi8gfSxcbiAgICB7XG4gICAgICBcIk5hbWVcIjogXCJEZXBsb3lcIixcbiAgICAgIFwiQWN0aW9uc1wiOiBbXG4gICAgICB7XG4gICAgICAgIFwiT3V0cHV0QXJ0aWZhY3RzXCI6IFt7XCJOYW1lXCI6IFwiRGVwbG95Q3JlYXRlVXBkYXRlQXJ0aWZhY3RcIn1dLFxuICAgICAgICBcIk5hbWVcIjogXCJDcmVhdGVVcGRhdGVcIixcbiAgICAgIH0sXG4gICAgICBdLFxuICAgIH1cbiAgICBdXG4gIH0pKTtcblxuICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAncmVwbGFjZU9uRmFpbHVyZSBzd2l0Y2hlcyBhY3Rpb24gdHlwZScodGVzdDogVGVzdCkge1xuICAvLyBHSVZFTlxuICBjb25zdCBzdGFjayA9IG5ldyBUZXN0Rml4dHVyZSgpO1xuXG4gIC8vIFdIRU5cbiAgbmV3IFBpcGVsaW5lQ3JlYXRlVXBkYXRlU3RhY2tBY3Rpb24oc3RhY2ssICdDcmVhdGVVcGRhdGUnLCB7XG4gICAgc3RhZ2U6IHN0YWNrLmRlcGxveVN0YWdlLFxuICAgIHN0YWNrTmFtZTogJ015U3RhY2snLFxuICAgIHRlbXBsYXRlUGF0aDogc3RhY2suc291cmNlLm91dHB1dEFydGlmYWN0LmF0UGF0aCgndGVtcGxhdGUueWFtbCcpLFxuICAgIHJlcGxhY2VPbkZhaWx1cmU6IHRydWUsXG4gICAgYWRtaW5QZXJtaXNzaW9uczogZmFsc2UsXG4gIH0pO1xuXG4gIC8vIFRIRU46IEFjdGlvbiBoYXMgb3V0cHV0IGFydGlmYWN0c1xuICBleHBlY3Qoc3RhY2spLnRvKGhhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICBcIlN0YWdlc1wiOiBbXG4gICAgeyBcIk5hbWVcIjogXCJTb3VyY2VcIiAvKiBkb24ndCBjYXJlIGFib3V0IHRoZSByZXN0ICovIH0sXG4gICAge1xuICAgICAgXCJOYW1lXCI6IFwiRGVwbG95XCIsXG4gICAgICBcIkFjdGlvbnNcIjogW1xuICAgICAge1xuICAgICAgICBcIkNvbmZpZ3VyYXRpb25cIjoge1xuICAgICAgICBcIkFjdGlvbk1vZGVcIjogXCJSRVBMQUNFX09OX0ZBSUxVUkVcIixcbiAgICAgICAgfSxcbiAgICAgICAgXCJOYW1lXCI6IFwiQ3JlYXRlVXBkYXRlXCIsXG4gICAgICB9LFxuICAgICAgXSxcbiAgICB9XG4gICAgXVxuICB9KSk7XG5cbiAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ3BhcmFtZXRlck92ZXJyaWRlcyBhcmUgc2VyaWFsaXplZCBhcyBhIHN0cmluZycodGVzdDogVGVzdCkge1xuICAvLyBHSVZFTlxuICBjb25zdCBzdGFjayA9IG5ldyBUZXN0Rml4dHVyZSgpO1xuXG4gIC8vIFdIRU5cbiAgbmV3IFBpcGVsaW5lQ3JlYXRlVXBkYXRlU3RhY2tBY3Rpb24oc3RhY2ssICdDcmVhdGVVcGRhdGUnLCB7XG4gICAgc3RhZ2U6IHN0YWNrLmRlcGxveVN0YWdlLFxuICAgIHN0YWNrTmFtZTogJ015U3RhY2snLFxuICAgIHRlbXBsYXRlUGF0aDogc3RhY2suc291cmNlLm91dHB1dEFydGlmYWN0LmF0UGF0aCgndGVtcGxhdGUueWFtbCcpLFxuICAgIGFkbWluUGVybWlzc2lvbnM6IGZhbHNlLFxuICAgIHBhcmFtZXRlck92ZXJyaWRlczoge1xuICAgIFJlcG9OYW1lOiBzdGFjay5yZXBvLnJlcG9zaXRvcnlOYW1lXG4gICAgfVxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChzdGFjaykudG8oaGF2ZVJlc291cmNlTGlrZSgnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgIFwiU3RhZ2VzXCI6IFtcbiAgICB7IFwiTmFtZVwiOiBcIlNvdXJjZVwiIC8qIGRvbid0IGNhcmUgYWJvdXQgdGhlIHJlc3QgKi8gfSxcbiAgICB7XG4gICAgICBcIk5hbWVcIjogXCJEZXBsb3lcIixcbiAgICAgIFwiQWN0aW9uc1wiOiBbXG4gICAgICB7XG4gICAgICAgIFwiQ29uZmlndXJhdGlvblwiOiB7XG4gICAgICAgIFwiUGFyYW1ldGVyT3ZlcnJpZGVzXCI6IHsgXCJGbjo6Sm9pblwiOiBbIFwiXCIsIFtcbiAgICAgICAgICBcIntcXFwiUmVwb05hbWVcXFwiOlxcXCJcIixcbiAgICAgICAgICB7IFwiRm46OkdldEF0dFwiOiBbIFwiTXlWZXJ5SW1wb3J0YW50UmVwbzExQkMzRUJEXCIsIFwiTmFtZVwiIF0gfSxcbiAgICAgICAgICBcIlxcXCJ9XCJcbiAgICAgICAgXV19XG4gICAgICAgIH0sXG4gICAgICAgIFwiTmFtZVwiOiBcIkNyZWF0ZVVwZGF0ZVwiLFxuICAgICAgfSxcbiAgICAgIF0sXG4gICAgfVxuICAgIF1cbiAgfSkpO1xuXG4gIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdBY3Rpb24gc2VydmljZSByb2xlIGlzIHBhc3NlZCB0byB0ZW1wbGF0ZScodGVzdDogVGVzdCkge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IFRlc3RGaXh0dXJlKCk7XG5cbiAgICBjb25zdCBpbXBvcnRlZFJvbGUgPSBSb2xlLmltcG9ydChzdGFjaywgJ0ltcG9ydGVkUm9sZScsIHtcbiAgICAgIHJvbGVBcm46ICdhcm46YXdzOmlhbTo6MDAwMDAwMDAwMDAwOnJvbGUvYWN0aW9uLXJvbGUnXG4gICAgfSk7XG4gICAgY29uc3QgZnJlc2hSb2xlID0gbmV3IFJvbGUoc3RhY2ssICdGcmVzaFJvbGUnLCB7XG4gICAgICBhc3N1bWVkQnk6IG5ldyBTZXJ2aWNlUHJpbmNpcGFsKCdtYWdpY3NlcnZpY2UnKVxuICAgIH0pO1xuXG4gICAgbmV3IFBpcGVsaW5lRXhlY3V0ZUNoYW5nZVNldEFjdGlvbihzdGFjay5waXBlbGluZSwgJ0ltcG9ydGVkUm9sZUFjdGlvbicsIHtcbiAgICAgIHJvbGU6IGltcG9ydGVkUm9sZSxcbiAgICAgIGNoYW5nZVNldE5hbWU6ICdtYWdpY1NldCcsXG4gICAgICBzdGFja05hbWU6ICdtYWdpY1N0YWNrJyxcbiAgICAgIHN0YWdlOiBzdGFjay5kZXBsb3lTdGFnZVxuICAgIH0pO1xuXG4gICAgbmV3IFBpcGVsaW5lRXhlY3V0ZUNoYW5nZVNldEFjdGlvbihzdGFjay5waXBlbGluZSwgJ0ZyZXNoUm9sZUFjdGlvbicsIHtcbiAgICAgIHJvbGU6IGZyZXNoUm9sZSxcbiAgICAgIGNoYW5nZVNldE5hbWU6ICdtYWdpY1NldCcsXG4gICAgICBzdGFja05hbWU6ICdtYWdpY1N0YWNrJyxcbiAgICAgIHN0YWdlOiBzdGFjay5kZXBsb3lTdGFnZVxuICAgIH0pO1xuXG4gICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2VMaWtlKCdBV1M6OkNvZGVQaXBlbGluZTo6UGlwZWxpbmUnLCB7XG4gICAgICBcIlN0YWdlc1wiOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBcIk5hbWVcIjogXCJTb3VyY2VcIiAvKiBkb24ndCBjYXJlIGFib3V0IHRoZSByZXN0ICovXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBcIk5hbWVcIjogXCJEZXBsb3lcIixcbiAgICAgICAgICBcIkFjdGlvbnNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBcIk5hbWVcIjogXCJJbXBvcnRlZFJvbGVBY3Rpb25cIixcbiAgICAgICAgICAgICAgXCJSb2xlQXJuXCI6IFwiYXJuOmF3czppYW06OjAwMDAwMDAwMDAwMDpyb2xlL2FjdGlvbi1yb2xlXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFwiTmFtZVwiOiBcIkZyZXNoUm9sZUFjdGlvblwiLFxuICAgICAgICAgICAgICBcIlJvbGVBcm5cIjoge1xuICAgICAgICAgICAgICAgIFwiRm46OkdldEF0dFwiOiBbXG4gICAgICAgICAgICAgICAgICBcIkZyZXNoUm9sZTQ3MkY2RTE4XCIsXG4gICAgICAgICAgICAgICAgICBcIkFyblwiXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSkpO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH1cbn07XG5cbi8qKlxuICogQSB0ZXN0IHN0YWNrIHdpdGggYSBoYWxmLXByZXBhcmVkIHBpcGVsaW5lIHJlYWR5IHRvIGFkZCBDbG91ZEZvcm1hdGlvbiBhY3Rpb25zIHRvXG4gKi9cbmNsYXNzIFRlc3RGaXh0dXJlIGV4dGVuZHMgY2RrLlN0YWNrIHtcbiAgcHVibGljIHJlYWRvbmx5IHBpcGVsaW5lOiBQaXBlbGluZTtcbiAgcHVibGljIHJlYWRvbmx5IHNvdXJjZVN0YWdlOiBTdGFnZTtcbiAgcHVibGljIHJlYWRvbmx5IGRlcGxveVN0YWdlOiBTdGFnZTtcbiAgcHVibGljIHJlYWRvbmx5IHJlcG86IFJlcG9zaXRvcnk7XG4gIHB1YmxpYyByZWFkb25seSBzb3VyY2U6IFBpcGVsaW5lU291cmNlQWN0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICBzdXBlcigpO1xuXG4gIHRoaXMucGlwZWxpbmUgPSBuZXcgUGlwZWxpbmUodGhpcywgJ1BpcGVsaW5lJyk7XG4gIHRoaXMuc291cmNlU3RhZ2UgPSBuZXcgU3RhZ2UodGhpcy5waXBlbGluZSwgJ1NvdXJjZScsIHsgcGlwZWxpbmU6IHRoaXMucGlwZWxpbmUgfSk7XG4gIHRoaXMuZGVwbG95U3RhZ2UgPSBuZXcgU3RhZ2UodGhpcy5waXBlbGluZSwgJ0RlcGxveScsIHsgcGlwZWxpbmU6IHRoaXMucGlwZWxpbmUgfSk7XG4gIHRoaXMucmVwbyA9IG5ldyBSZXBvc2l0b3J5KHRoaXMsICdNeVZlcnlJbXBvcnRhbnRSZXBvJywgeyByZXBvc2l0b3J5TmFtZTogJ215LXZlcnktaW1wb3J0YW50LXJlcG8nIH0pO1xuICB0aGlzLnNvdXJjZSA9IG5ldyBQaXBlbGluZVNvdXJjZUFjdGlvbih0aGlzLCAnU291cmNlJywge1xuICAgIHN0YWdlOiB0aGlzLnNvdXJjZVN0YWdlLFxuICAgIG91dHB1dEFydGlmYWN0TmFtZTogJ1NvdXJjZUFydGlmYWN0JyxcbiAgICByZXBvc2l0b3J5OiB0aGlzLnJlcG8sXG4gIH0pO1xuICB9XG59XG4iXX0=