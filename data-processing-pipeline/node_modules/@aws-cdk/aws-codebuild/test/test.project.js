"use strict";
const assert_1 = require("@aws-cdk/assert");
const assets = require("@aws-cdk/assets");
const cdk = require("@aws-cdk/cdk");
const codebuild = require("../lib");
module.exports = {
    'can use filename as buildspec'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new codebuild.Project(stack, 'Project', {
            source: new codebuild.CodePipelineSource(),
            buildSpec: 'hello.yml',
        });
        // THEN
        assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::Project', {
            Source: {
                BuildSpec: 'hello.yml'
            }
        }));
        test.done();
    },
    'can use buildspec literal'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new codebuild.Project(stack, 'Project', {
            source: new codebuild.CodePipelineSource(),
            buildSpec: { phases: ['say hi'] }
        });
        // THEN
        assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::Project', {
            Source: {
                BuildSpec: "{\n  \"phases\": [\n    \"say hi\"\n  ]\n}",
            }
        }));
        test.done();
    },
    'GitHub source': {
        'has reportBuildStatus on by default'(test) {
            // GIVEN
            const stack = new cdk.Stack();
            // WHEN
            new codebuild.Project(stack, 'Project', {
                source: new codebuild.GitHubSource({
                    owner: 'testowner',
                    repo: 'testrepo',
                    oauthToken: new cdk.Secret("test_oauth_token")
                })
            });
            // THEN
            assert_1.expect(stack).to(assert_1.haveResource('AWS::CodeBuild::Project', {
                Source: {
                    Type: "GITHUB",
                    Auth: {
                        Type: 'OAUTH',
                        Resource: 'test_oauth_token'
                    },
                    Location: 'https://github.com/testowner/testrepo.git',
                    ReportBuildStatus: true,
                }
            }));
            test.done();
        },
        'can explicitly set reportBuildStatus to false'(test) {
            // GIVEN
            const stack = new cdk.Stack();
            // WHEN
            new codebuild.Project(stack, 'Project', {
                source: new codebuild.GitHubSource({
                    owner: 'testowner',
                    repo: 'testrepo',
                    oauthToken: new cdk.Secret('test_oauth_token'),
                    reportBuildStatus: false,
                })
            });
            // THEN
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::Project', {
                Source: {
                    ReportBuildStatus: false,
                },
            }));
            test.done();
        },
        'can explicitly set webhook to true'(test) {
            // GIVEN
            const stack = new cdk.Stack();
            // WHEN
            new codebuild.Project(stack, 'Project', {
                source: new codebuild.GitHubSource({
                    owner: 'testowner',
                    repo: 'testrepo',
                    oauthToken: new cdk.Secret('test_oauth_token'),
                    webhook: true,
                })
            });
            // THEN
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::Project', {
                Triggers: {
                    Webhook: true,
                },
            }));
            test.done();
        },
    },
    'github enterprise auth test'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new codebuild.Project(stack, 'Project', {
            source: new codebuild.GitHubEnterpriseSource({
                httpsCloneUrl: 'https://github.testcompany.com/testowner/testrepo',
                ignoreSslErrors: true,
                oauthToken: new cdk.Secret("test_oauth_token")
            })
        });
        // THEN
        assert_1.expect(stack).to(assert_1.haveResource('AWS::CodeBuild::Project', {
            Source: {
                Type: "GITHUB_ENTERPRISE",
                Auth: {
                    Type: 'OAUTH',
                    Resource: 'test_oauth_token'
                },
                InsecureSsl: true,
                Location: 'https://github.testcompany.com/testowner/testrepo'
            }
        }));
        test.done();
    },
    'bitbucket auth test'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new codebuild.Project(stack, 'Project', {
            source: new codebuild.BitBucketSource({
                owner: 'testowner',
                repo: 'testrepo',
            })
        });
        // THEN
        assert_1.expect(stack).to(assert_1.haveResource('AWS::CodeBuild::Project', {
            Source: {
                Type: 'BITBUCKET',
                Location: 'https://bitbucket.org/testowner/testrepo.git',
            },
        }));
        test.done();
    },
    'construct from asset'(test) {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new codebuild.Project(stack, 'Project', {
            buildScriptAsset: new assets.ZipDirectoryAsset(stack, 'Asset', { path: '.' }),
            buildScriptAssetEntrypoint: 'hello.sh',
        });
        // THEN
        assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::Project', {
            Environment: {
                ComputeType: "BUILD_GENERAL1_SMALL",
                EnvironmentVariables: [
                    {
                        Name: "SCRIPT_S3_BUCKET",
                        Type: "PLAINTEXT",
                        Value: { Ref: "AssetS3Bucket235698C0" }
                    },
                    {
                        Name: "SCRIPT_S3_KEY",
                        Type: "PLAINTEXT",
                        Value: {
                            "Fn::Join": ["", [
                                    { "Fn::Select": [0, { "Fn::Split": ["||", { Ref: "AssetS3VersionKeyA852DDAE" }] }] },
                                    { "Fn::Select": [1, { "Fn::Split": ["||", { Ref: "AssetS3VersionKeyA852DDAE" }] }] }
                                ]]
                        }
                    }
                ],
            },
            Source: {
                // Not testing BuildSpec, it's too big and finicky
                Type: "NO_SOURCE"
            }
        }));
        test.done();
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5wcm9qZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGVzdC5wcm9qZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw0Q0FBeUU7QUFDekUsMENBQTJDO0FBQzNDLG9DQUFxQztBQUVyQyxvQ0FBcUM7QUFJckMsaUJBQVM7SUFDUCwrQkFBK0IsQ0FBQyxJQUFVO1FBQ3hDLFFBQVE7UUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUU5QixPQUFPO1FBQ1AsSUFBSSxTQUFTLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUU7WUFDdEMsTUFBTSxFQUFFLElBQUksU0FBUyxDQUFDLGtCQUFrQixFQUFFO1lBQzFDLFNBQVMsRUFBRSxXQUFXO1NBQ3ZCLENBQUMsQ0FBQztRQUVILE9BQU87UUFDUCxlQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLHlCQUFnQixDQUFDLHlCQUF5QixFQUFFO1lBQzNELE1BQU0sRUFBRTtnQkFDTixTQUFTLEVBQUUsV0FBVzthQUN2QjtTQUNGLENBQUMsQ0FBQyxDQUFDO1FBRUosSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUVELDJCQUEyQixDQUFDLElBQVU7UUFDcEMsUUFBUTtRQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRTlCLE9BQU87UUFDUCxJQUFJLFNBQVMsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRTtZQUN0QyxNQUFNLEVBQUUsSUFBSSxTQUFTLENBQUMsa0JBQWtCLEVBQUU7WUFDMUMsU0FBUyxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUU7U0FDbEMsQ0FBQyxDQUFDO1FBRUgsT0FBTztRQUNQLGVBQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMseUJBQWdCLENBQUMseUJBQXlCLEVBQUU7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QUUsRUFBRSxHQUFHLEVBQUUsMkJBQTJCLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtpQ0FDckYsQ0FBQzt5QkFDSDtxQkFDRjtpQkFDRjthQUNGO1lBQ0QsTUFBTSxFQUFFO2dCQUNOLGtEQUFrRDtnQkFDbEQsSUFBSSxFQUFFLFdBQVc7YUFDbEI7U0FDRixDQUFDLENBQUMsQ0FBQztRQUVKLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNkLENBQUM7Q0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhwZWN0LCBoYXZlUmVzb3VyY2UsIGhhdmVSZXNvdXJjZUxpa2UgfSBmcm9tICdAYXdzLWNkay9hc3NlcnQnO1xuaW1wb3J0IGFzc2V0cyA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2Fzc2V0cycpO1xuaW1wb3J0IGNkayA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2NkaycpO1xuaW1wb3J0IHsgVGVzdCB9IGZyb20gJ25vZGV1bml0JztcbmltcG9ydCBjb2RlYnVpbGQgPSByZXF1aXJlKCcuLi9saWInKTtcblxuLy8gdHNsaW50OmRpc2FibGU6b2JqZWN0LWxpdGVyYWwta2V5LXF1b3Rlc1xuXG5leHBvcnQgPSB7XG4gICdjYW4gdXNlIGZpbGVuYW1lIGFzIGJ1aWxkc3BlYycodGVzdDogVGVzdCkge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IGNvZGVidWlsZC5Qcm9qZWN0KHN0YWNrLCAnUHJvamVjdCcsIHtcbiAgICAgIHNvdXJjZTogbmV3IGNvZGVidWlsZC5Db2RlUGlwZWxpbmVTb3VyY2UoKSxcbiAgICAgIGJ1aWxkU3BlYzogJ2hlbGxvLnltbCcsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2VMaWtlKCdBV1M6OkNvZGVCdWlsZDo6UHJvamVjdCcsIHtcbiAgICAgIFNvdXJjZToge1xuICAgICAgICBCdWlsZFNwZWM6ICdoZWxsby55bWwnXG4gICAgICB9XG4gICAgfSkpO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2NhbiB1c2UgYnVpbGRzcGVjIGxpdGVyYWwnKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBjb2RlYnVpbGQuUHJvamVjdChzdGFjaywgJ1Byb2plY3QnLCB7XG4gICAgICBzb3VyY2U6IG5ldyBjb2RlYnVpbGQuQ29kZVBpcGVsaW5lU291cmNlKCksXG4gICAgICBidWlsZFNwZWM6IHsgcGhhc2VzOiBbJ3NheSBoaSddIH1cbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3Qoc3RhY2spLnRvKGhhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6Q29kZUJ1aWxkOjpQcm9qZWN0Jywge1xuICAgICAgU291cmNlOiB7XG4gICAgICAgIEJ1aWxkU3BlYzogXCJ7XFxuICBcXFwicGhhc2VzXFxcIjogW1xcbiAgICBcXFwic2F5IGhpXFxcIlxcbiAgXVxcbn1cIixcbiAgICAgIH1cbiAgICB9KSk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnR2l0SHViIHNvdXJjZSc6IHtcbiAgICAnaGFzIHJlcG9ydEJ1aWxkU3RhdHVzIG9uIGJ5IGRlZmF1bHQnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgbmV3IGNvZGVidWlsZC5Qcm9qZWN0KHN0YWNrLCAnUHJvamVjdCcsIHtcbiAgICAgICAgc291cmNlOiBuZXcgY29kZWJ1aWxkLkdpdEh1YlNvdXJjZSh7XG4gICAgICAgICAgb3duZXI6ICd0ZXN0b3duZXInLFxuICAgICAgICAgIHJlcG86ICd0ZXN0cmVwbycsXG4gICAgICAgICAgb2F1dGhUb2tlbjogbmV3IGNkay5TZWNyZXQoXCJ0ZXN0X29hdXRoX3Rva2VuXCIpXG4gICAgICAgIH0pXG4gICAgICB9KTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ0FXUzo6Q29kZUJ1aWxkOjpQcm9qZWN0Jywge1xuICAgICAgICBTb3VyY2U6IHtcbiAgICAgICAgICBUeXBlOiBcIkdJVEhVQlwiLFxuICAgICAgICAgIEF1dGg6IHtcbiAgICAgICAgICAgIFR5cGU6ICdPQVVUSCcsXG4gICAgICAgICAgICBSZXNvdXJjZTogJ3Rlc3Rfb2F1dGhfdG9rZW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBMb2NhdGlvbjogJ2h0dHBzOi8vZ2l0aHViLmNvbS90ZXN0b3duZXIvdGVzdHJlcG8uZ2l0JyxcbiAgICAgICAgICBSZXBvcnRCdWlsZFN0YXR1czogdHJ1ZSxcbiAgICAgICAgfVxuICAgICAgfSkpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuXG4gICAgJ2NhbiBleHBsaWNpdGx5IHNldCByZXBvcnRCdWlsZFN0YXR1cyB0byBmYWxzZScodGVzdDogVGVzdCkge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBuZXcgY29kZWJ1aWxkLlByb2plY3Qoc3RhY2ssICdQcm9qZWN0Jywge1xuICAgICAgICBzb3VyY2U6IG5ldyBjb2RlYnVpbGQuR2l0SHViU291cmNlKHtcbiAgICAgICAgICBvd25lcjogJ3Rlc3Rvd25lcicsXG4gICAgICAgICAgcmVwbzogJ3Rlc3RyZXBvJyxcbiAgICAgICAgICBvYXV0aFRva2VuOiBuZXcgY2RrLlNlY3JldCgndGVzdF9vYXV0aF90b2tlbicpLFxuICAgICAgICAgIHJlcG9ydEJ1aWxkU3RhdHVzOiBmYWxzZSxcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBleHBlY3Qoc3RhY2spLnRvKGhhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6Q29kZUJ1aWxkOjpQcm9qZWN0Jywge1xuICAgICAgICBTb3VyY2U6IHtcbiAgICAgICAgICBSZXBvcnRCdWlsZFN0YXR1czogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG5cbiAgICAgIHRlc3QuZG9uZSgpO1xuICAgIH0sXG5cbiAgICAnY2FuIGV4cGxpY2l0bHkgc2V0IHdlYmhvb2sgdG8gdHJ1ZScodGVzdDogVGVzdCkge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBuZXcgY29kZWJ1aWxkLlByb2plY3Qoc3RhY2ssICdQcm9qZWN0Jywge1xuICAgICAgICBzb3VyY2U6IG5ldyBjb2RlYnVpbGQuR2l0SHViU291cmNlKHtcbiAgICAgICAgICBvd25lcjogJ3Rlc3Rvd25lcicsXG4gICAgICAgICAgcmVwbzogJ3Rlc3RyZXBvJyxcbiAgICAgICAgICBvYXV0aFRva2VuOiBuZXcgY2RrLlNlY3JldCgndGVzdF9vYXV0aF90b2tlbicpLFxuICAgICAgICAgIHdlYmhvb2s6IHRydWUsXG4gICAgICAgIH0pXG4gICAgICB9KTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2VMaWtlKCdBV1M6OkNvZGVCdWlsZDo6UHJvamVjdCcsIHtcbiAgICAgICAgVHJpZ2dlcnM6IHtcbiAgICAgICAgICBXZWJob29rOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuICB9LFxuXG4gICdnaXRodWIgZW50ZXJwcmlzZSBhdXRoIHRlc3QnKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBjb2RlYnVpbGQuUHJvamVjdChzdGFjaywgJ1Byb2plY3QnLCB7XG4gICAgICBzb3VyY2U6IG5ldyBjb2RlYnVpbGQuR2l0SHViRW50ZXJwcmlzZVNvdXJjZSh7XG4gICAgICAgIGh0dHBzQ2xvbmVVcmw6ICdodHRwczovL2dpdGh1Yi50ZXN0Y29tcGFueS5jb20vdGVzdG93bmVyL3Rlc3RyZXBvJyxcbiAgICAgICAgaWdub3JlU3NsRXJyb3JzOiB0cnVlLFxuICAgICAgICBvYXV0aFRva2VuOiBuZXcgY2RrLlNlY3JldChcInRlc3Rfb2F1dGhfdG9rZW5cIilcbiAgICAgIH0pXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ0FXUzo6Q29kZUJ1aWxkOjpQcm9qZWN0Jywge1xuICAgICAgU291cmNlOiB7XG4gICAgICAgIFR5cGU6IFwiR0lUSFVCX0VOVEVSUFJJU0VcIixcbiAgICAgICAgQXV0aDoge1xuICAgICAgICAgIFR5cGU6ICdPQVVUSCcsXG4gICAgICAgICAgUmVzb3VyY2U6ICd0ZXN0X29hdXRoX3Rva2VuJ1xuICAgICAgICB9LFxuICAgICAgICBJbnNlY3VyZVNzbDogdHJ1ZSxcbiAgICAgICAgTG9jYXRpb246ICdodHRwczovL2dpdGh1Yi50ZXN0Y29tcGFueS5jb20vdGVzdG93bmVyL3Rlc3RyZXBvJ1xuICAgICAgfVxuICAgIH0pKTtcblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdiaXRidWNrZXQgYXV0aCB0ZXN0Jyh0ZXN0OiBUZXN0KSB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgIC8vIFdIRU5cbiAgICBuZXcgY29kZWJ1aWxkLlByb2plY3Qoc3RhY2ssICdQcm9qZWN0Jywge1xuICAgICAgc291cmNlOiBuZXcgY29kZWJ1aWxkLkJpdEJ1Y2tldFNvdXJjZSh7XG4gICAgICAgIG93bmVyOiAndGVzdG93bmVyJyxcbiAgICAgICAgcmVwbzogJ3Rlc3RyZXBvJyxcbiAgICAgIH0pXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ0FXUzo6Q29kZUJ1aWxkOjpQcm9qZWN0Jywge1xuICAgICAgU291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdCSVRCVUNLRVQnLFxuICAgICAgICBMb2NhdGlvbjogJ2h0dHBzOi8vYml0YnVja2V0Lm9yZy90ZXN0b3duZXIvdGVzdHJlcG8uZ2l0JyxcbiAgICAgIH0sXG4gICAgfSkpO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2NvbnN0cnVjdCBmcm9tIGFzc2V0Jyh0ZXN0OiBUZXN0KSB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgIC8vIFdIRU5cbiAgICBuZXcgY29kZWJ1aWxkLlByb2plY3Qoc3RhY2ssICdQcm9qZWN0Jywge1xuICAgICAgYnVpbGRTY3JpcHRBc3NldDogbmV3IGFzc2V0cy5aaXBEaXJlY3RvcnlBc3NldChzdGFjaywgJ0Fzc2V0JywgeyBwYXRoOiAnLicgfSksXG4gICAgICBidWlsZFNjcmlwdEFzc2V0RW50cnlwb2ludDogJ2hlbGxvLnNoJyxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3Qoc3RhY2spLnRvKGhhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6Q29kZUJ1aWxkOjpQcm9qZWN0Jywge1xuICAgICAgRW52aXJvbm1lbnQ6IHtcbiAgICAgICAgQ29tcHV0ZVR5cGU6IFwiQlVJTERfR0VORVJBTDFfU01BTExcIixcbiAgICAgICAgRW52aXJvbm1lbnRWYXJpYWJsZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBOYW1lOiBcIlNDUklQVF9TM19CVUNLRVRcIixcbiAgICAgICAgICAgIFR5cGU6IFwiUExBSU5URVhUXCIsXG4gICAgICAgICAgICBWYWx1ZTogeyBSZWY6IFwiQXNzZXRTM0J1Y2tldDIzNTY5OEMwXCIgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgTmFtZTogXCJTQ1JJUFRfUzNfS0VZXCIsXG4gICAgICAgICAgICBUeXBlOiBcIlBMQUlOVEVYVFwiLFxuICAgICAgICAgICAgVmFsdWU6IHtcbiAgICAgICAgICAgICAgXCJGbjo6Sm9pblwiOiBbXCJcIiwgW1xuICAgICAgICAgICAgICAgIHsgXCJGbjo6U2VsZWN0XCI6IFswLCB7IFwiRm46OlNwbGl0XCI6IFtcInx8XCIsIHsgUmVmOiBcIkFzc2V0UzNWZXJzaW9uS2V5QTg1MkREQUVcIiB9XSB9XSB9LFxuICAgICAgICAgICAgICAgIHsgXCJGbjo6U2VsZWN0XCI6IFsxLCB7IFwiRm46OlNwbGl0XCI6IFtcInx8XCIsIHsgUmVmOiBcIkFzc2V0UzNWZXJzaW9uS2V5QTg1MkREQUVcIiB9XSB9XSB9XG4gICAgICAgICAgICAgIF1dXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICAgIFNvdXJjZToge1xuICAgICAgICAvLyBOb3QgdGVzdGluZyBCdWlsZFNwZWMsIGl0J3MgdG9vIGJpZyBhbmQgZmluaWNreVxuICAgICAgICBUeXBlOiBcIk5PX1NPVVJDRVwiXG4gICAgICB9XG4gICAgfSkpO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG59O1xuIl19